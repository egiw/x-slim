{% extends template %}

{% set title %}
    {% trans %} Update Article  {% endtrans %}
{% endset %}

{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <h1>
                {% trans %} Edit Article {% endtrans %}
                <small>
                    {% trans %} 
                        Update and publish or save as draft i18n
                    {% endtrans %}
                </small>
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a data-pjax href="{{ urlFor('admin.index') }}">
                        <i class="fa fa-dashboard"></i> 
                        {% trans %} Dashboard {% endtrans %}
                    </a>
                </li>
                <li>
                    <a data-pjax href="{{ urlFor('admin.article.index') }}">
                        <i class="fa fa-file"></i> 
                        {% trans %} Article {% endtrans %}
                    </a>
                </li>
                {% if i18n.article.i18n.count > 1 %}
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span class="text-info">{{ i18n.language|upper }}</span>
                            <strong>&middot;</strong>
                            {{ i18n.title }}
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            {% for translation in i18n.article.i18n if translation is not sameas(i18n) %}
                                <li>
                                    <a href="{{ urlFor('admin.article.edit', {id: translation.id}) }}" data-pjax>
                                        <span class="text-info">{{ translation.language|upper }}</span>
                                        <strong>&middot;</strong>
                                        {{ translation.title }}
                                        <span class="caret"></span>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% else %}
                    <li class="active">
                        <span class="text-info">{{ i18n.language|upper }}</span>
                        <strong>&middot;</strong>
                        {{ i18n.title }}
                    </li>
                {% endif %}
                <li class="active">
                    <i class="fa fa-edit"></i> 
                    {% trans %} Edit {% endtrans %}
                </li>
            </ol>
        </div>
    </div>

    <form data-pjax method="post" role="form" 
          class="form-horizontal" 
          action="{{ urlFor('admin.article.edit', {id: i18n.id}) }}">

        <div class="form-group">
            <label for="select-language" class="control-label col-sm-2">
                {% trans %} Language {% endtrans %}
            </label>
            <div class="col-sm-2">
                {{
                    html.select(languages, input['language']|default(i18n.language), {
                        class: 'form-control',
                        id: 'select-language',
                        disabled: true
                    })
                }}
            </div>
        </div>

        <div class="form-group {% if error.title %} has-error {% endif %}">
            <label class="control-label col-sm-2" for="title">
                {% trans %} Title {% endtrans %}
            </label>
            <div class="col-sm-10">
                <input type="text" class="form-control" 
                       name="title" 
                       value="{{ input['title']|default(i18n.title) }}" 
                       placeholder="{% trans 'Enter Title' %}"/>
                {{ html.error(error.title) }}
            </div>
        </div>

        {#         CATEGORIES        #}
        <div class="form-group">
            <label for="select-categories" class="control-label col-sm-2">
                {% trans %} Categories {% endtrans %}
            </label>
            <div class="col-sm-10">
                <select name="categories[]" id="select-categories" class="form-control" multiple>
                    {% for category in categories %}
                        {% set label %}
                            {% for translation in category.translations %} 
                                {{ translation.name }} 
                                {% if not loop.last %} &middot; {% endif %} 
                            {% endfor %}
                        {% endset %}
                        <optgroup label="{{ label }}">
                            {% for subcategory in category.subcategories %}
                                <option value="{{ subcategory.id }}" 
                                        {% if i18n.categories.contains(subcategory) %} selected {% endif %}> 
                                    {% for translation in subcategory.translations %}
                                        {{ translation.name }}
                                        {% if not loop.last %} &middot; {% endif %}
                                    {% endfor %}
                                </option>
                            {% endfor %}    
                        </optgroup>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="select-regions" class="control-label col-sm-2">
                {% trans %} Regions {% endtrans %}
            </label>
            <div class="col-sm-10">
                <select name="regions[]" id="select-regions" class="form-control" multiple>
                    {% for region in regions %}
                        <optgroup label="{{ region.name }}">
                            {% for province in region.children %}
                                <option value="{{ province.id }}"
                                        {% if i18n.article.regions.contains(province) %} selected {% endif %}>
                                    {{ province.name }}
                                </option>
                            {% endfor %}
                            {% for province in region.children %}
                            <optgroup label="{{ province.name }}">
                                {% for city in province.children %}
                                    <option value="{{ city.id }}"
                                            {% if i18n.article.regions.contains(city) %} selected {% endif %}>
                                        {{ city.name }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endfor %}
                        </optgroup>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group {% if error.content %} has-error {% endif %}">
            <label class="control-label col-sm-2" for="content">
                {% trans %} Content {% endtrans %}
            </label>
            <div class="col-sm-10">
                <textarea id="textarea-content" name="content" 
                          class="form-control" cols="30" rows="10" 
                          placeholder="Content">{{ input['content']|default(i18n.content) }}
                </textarea>
                {{ html.error(error.content) }}
            </div>
        </div>

        {#       RELATED ARTICLE    #}
        <div class="form-group">
            <label for="select-related" class="control-label col-sm-2">
                {% trans %} Related {% endtrans %}
            </label>
            <div class="col-sm-10">
                <select name="related[]" id="select-related" class="form-control" multiple>
                    {% for article in related if article is not sameas(i18n.article) %}
                        <option value="{{ article.id }}" 
                                {% if i18n.article.related.contains(article) %} selected {% endif %}>
                            {{ article.i18n.first.title }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="select-status" class="control-label col-sm-2">
                {% trans %} Status {% endtrans %}
            </label>
            <div class="col-sm-2">
                <select name="status" id="select-status" class="form-control">
                    {% if not _user.contributor %}
                        <option value="{{ constant('Article::STATUS_PUBLISH') }}"
                                {% if i18n.publish %} selected {% endif %}>
                            {% trans %} Publish {% endtrans %}
                        </option>
                    {% endif %}
                    <option value="{{ constant('Article::STATUS_PENDING') }}"
                            {% if i18n.pending %} selected {% endif %}>
                        {% trans %} Need Review {% endtrans %}
                    </option>
                    <option value="{{ constant('Article::STATUS_DRAFT') }}"
                            {% if i18n.draft %} selected {% endif %}>
                        {% trans %} Draft {% endtrans %}
                    </option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <div class="btn-group">
                    <input type="submit" class="btn btn-primary" 
                           value="Submit" />
                    <a data-pjax href="{{ urlFor('admin.article.index') }}" 
                       class="btn btn-default">
                        {% trans %} Cancel {% endtrans %}
                    </a>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(function() {
            $("#textarea-content").summernote({
                height: 350
            });
            $('#select-categories, #select-regions, #select-related').chosen();
        });
    </script>
{% endblock %}